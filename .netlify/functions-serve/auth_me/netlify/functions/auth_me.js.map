{
  "version": 3,
  "sources": ["../../workspaces/overland/netlify/functions/auth_me.mjs"],
  "sourceRoot": "/tmp/tmp-13217-vga7r5KGQ7k4",
  "sourcesContent": ["import crypto from 'crypto'\nconst SESSION_SECRET = (process.env.SESSION_SECRET || '').trim()\n\nconst json = (status, data, event) => {\n  const origin = event?.headers?.origin || ''\n  const cors = {\n    'Content-Type': 'application/json',\n    'Access-Control-Allow-Origin': origin || '*',\n    'Access-Control-Allow-Credentials': 'true',\n    'Access-Control-Allow-Headers': 'Content-Type',\n    'Access-Control-Allow-Methods': 'GET,OPTIONS',\n    'Vary': 'Origin'\n  }\n  return { statusCode: status, headers: cors, body: JSON.stringify(data) }\n}\nfunction verify(token){\n  if(!token || !SESSION_SECRET) return null\n  const [body, sig] = token.split('.')\n  const expected = crypto.createHmac('sha256', SESSION_SECRET).update(body).digest('base64url')\n  if (sig !== expected) return null\n  const payload = JSON.parse(Buffer.from(body, 'base64url').toString('utf8'))\n  if (payload.exp < Math.floor(Date.now()/1000)) return null\n  return payload\n}\nfunction getCookie(cookies, name){\n  if (!cookies) return null\n  const m = cookies.split(/; */).find(c=>c.startsWith(name+'='))\n  return m ? decodeURIComponent(m.split('=')[1]) : null\n}\n\nexport async function handler(event){\n  if (event.httpMethod === 'OPTIONS') return json(200, {}, event)\n  const token = getCookie(event.headers.cookie, 'session')\n  const payload = verify(token)\n  if(!payload) return json(401, { error: 'Unauthorized' }, event)\n  return json(200, { ok: true, sub: payload.sub, exp: payload.exp }, event)\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAmB;AACnB,IAAM,kBAAkB,QAAQ,IAAI,kBAAkB,IAAI,KAAK;AAE/D,IAAM,OAAO,CAAC,QAAQ,MAAM,UAAU;AACpC,QAAM,SAAS,OAAO,SAAS,UAAU;AACzC,QAAM,OAAO;AAAA,IACX,gBAAgB;AAAA,IAChB,+BAA+B,UAAU;AAAA,IACzC,oCAAoC;AAAA,IACpC,gCAAgC;AAAA,IAChC,gCAAgC;AAAA,IAChC,QAAQ;AAAA,EACV;AACA,SAAO,EAAE,YAAY,QAAQ,SAAS,MAAM,MAAM,KAAK,UAAU,IAAI,EAAE;AACzE;AACA,SAAS,OAAO,OAAM;AACpB,MAAG,CAAC,SAAS,CAAC,eAAgB,QAAO;AACrC,QAAM,CAAC,MAAM,GAAG,IAAI,MAAM,MAAM,GAAG;AACnC,QAAM,WAAW,cAAAA,QAAO,WAAW,UAAU,cAAc,EAAE,OAAO,IAAI,EAAE,OAAO,WAAW;AAC5F,MAAI,QAAQ,SAAU,QAAO;AAC7B,QAAM,UAAU,KAAK,MAAM,OAAO,KAAK,MAAM,WAAW,EAAE,SAAS,MAAM,CAAC;AAC1E,MAAI,QAAQ,MAAM,KAAK,MAAM,KAAK,IAAI,IAAE,GAAI,EAAG,QAAO;AACtD,SAAO;AACT;AACA,SAAS,UAAU,SAAS,MAAK;AAC/B,MAAI,CAAC,QAAS,QAAO;AACrB,QAAM,IAAI,QAAQ,MAAM,KAAK,EAAE,KAAK,OAAG,EAAE,WAAW,OAAK,GAAG,CAAC;AAC7D,SAAO,IAAI,mBAAmB,EAAE,MAAM,GAAG,EAAE,CAAC,CAAC,IAAI;AACnD;AAEA,eAAsB,QAAQ,OAAM;AAClC,MAAI,MAAM,eAAe,UAAW,QAAO,KAAK,KAAK,CAAC,GAAG,KAAK;AAC9D,QAAM,QAAQ,UAAU,MAAM,QAAQ,QAAQ,SAAS;AACvD,QAAM,UAAU,OAAO,KAAK;AAC5B,MAAG,CAAC,QAAS,QAAO,KAAK,KAAK,EAAE,OAAO,eAAe,GAAG,KAAK;AAC9D,SAAO,KAAK,KAAK,EAAE,IAAI,MAAM,KAAK,QAAQ,KAAK,KAAK,QAAQ,IAAI,GAAG,KAAK;AAC1E;",
  "names": ["crypto"]
}
