{
  "version": 3,
  "sources": ["../../workspaces/overland/netlify/functions/auth_login.mjs"],
  "sourceRoot": "/tmp/tmp-13217-3Lix1RkHpO6L",
  "sourcesContent": ["import crypto from 'crypto'\n\nconst ADMIN_PASSWORD = (process.env.ADMIN_PASSWORD || '').trim()\nconst SESSION_SECRET = (process.env.SESSION_SECRET || '').trim()\n\nconst json = (status, data, event) => {\n  const origin = event?.headers?.origin || ''\n  const cors = {\n    'Content-Type': 'application/json',\n    'Access-Control-Allow-Origin': origin || '*',\n    'Access-Control-Allow-Credentials': 'true',\n    'Access-Control-Allow-Headers': 'Content-Type',\n    'Access-Control-Allow-Methods': 'POST,OPTIONS',\n    'Vary': 'Origin'\n  }\n  return { statusCode: status, headers: cors, body: JSON.stringify(data) }\n}\n\nfunction sign(payload){\n  const body = Buffer.from(JSON.stringify(payload)).toString('base64url')\n  const sig = crypto.createHmac('sha256', SESSION_SECRET).update(body).digest('base64url')\n  return `${body}.${sig}`\n}\n\nexport async function handler(event) {\n  if (event.httpMethod === 'OPTIONS') return json(200, {}, event)\n  if (event.httpMethod !== 'POST') return json(405, { error: 'Method not allowed' }, event)\n\n  if (!ADMIN_PASSWORD || !SESSION_SECRET) return json(500, { error: 'Missing env vars' }, event)\n\n  const { password } = JSON.parse(event.body || '{}')\n  if ((password || '') !== ADMIN_PASSWORD) return json(401, { error: 'Invalid credentials' }, event)\n\n  const now = Math.floor(Date.now()/1000)\n  const exp = now + 7*24*3600 // 7 dias\n  const token = sign({ sub: 'admin', iat: now, exp })\n\n  const secure = true // no Netlify \u00E9 https\n  const cookie = `session=${token}; HttpOnly; Secure=${secure? '': ''}; SameSite=Strict; Path=/; Max-Age=${7*24*3600}`\n\n  return {\n    ...json(200, { ok: true }, event),\n    headers: { ...json(200, {}, event).headers, 'Set-Cookie': cookie }\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAmB;AAEnB,IAAM,kBAAkB,QAAQ,IAAI,kBAAkB,IAAI,KAAK;AAC/D,IAAM,kBAAkB,QAAQ,IAAI,kBAAkB,IAAI,KAAK;AAE/D,IAAM,OAAO,CAAC,QAAQ,MAAM,UAAU;AACpC,QAAM,SAAS,OAAO,SAAS,UAAU;AACzC,QAAM,OAAO;AAAA,IACX,gBAAgB;AAAA,IAChB,+BAA+B,UAAU;AAAA,IACzC,oCAAoC;AAAA,IACpC,gCAAgC;AAAA,IAChC,gCAAgC;AAAA,IAChC,QAAQ;AAAA,EACV;AACA,SAAO,EAAE,YAAY,QAAQ,SAAS,MAAM,MAAM,KAAK,UAAU,IAAI,EAAE;AACzE;AAEA,SAAS,KAAK,SAAQ;AACpB,QAAM,OAAO,OAAO,KAAK,KAAK,UAAU,OAAO,CAAC,EAAE,SAAS,WAAW;AACtE,QAAM,MAAM,cAAAA,QAAO,WAAW,UAAU,cAAc,EAAE,OAAO,IAAI,EAAE,OAAO,WAAW;AACvF,SAAO,GAAG,IAAI,IAAI,GAAG;AACvB;AAEA,eAAsB,QAAQ,OAAO;AACnC,MAAI,MAAM,eAAe,UAAW,QAAO,KAAK,KAAK,CAAC,GAAG,KAAK;AAC9D,MAAI,MAAM,eAAe,OAAQ,QAAO,KAAK,KAAK,EAAE,OAAO,qBAAqB,GAAG,KAAK;AAExF,MAAI,CAAC,kBAAkB,CAAC,eAAgB,QAAO,KAAK,KAAK,EAAE,OAAO,mBAAmB,GAAG,KAAK;AAE7F,QAAM,EAAE,SAAS,IAAI,KAAK,MAAM,MAAM,QAAQ,IAAI;AAClD,OAAK,YAAY,QAAQ,eAAgB,QAAO,KAAK,KAAK,EAAE,OAAO,sBAAsB,GAAG,KAAK;AAEjG,QAAM,MAAM,KAAK,MAAM,KAAK,IAAI,IAAE,GAAI;AACtC,QAAM,MAAM,MAAM,IAAE,KAAG;AACvB,QAAM,QAAQ,KAAK,EAAE,KAAK,SAAS,KAAK,KAAK,IAAI,CAAC;AAElD,QAAM,SAAS;AACf,QAAM,SAAS,WAAW,KAAK,sBAAsB,SAAQ,KAAI,EAAE,sCAAsC,IAAE,KAAG,IAAI;AAElH,SAAO;AAAA,IACL,GAAG,KAAK,KAAK,EAAE,IAAI,KAAK,GAAG,KAAK;AAAA,IAChC,SAAS,EAAE,GAAG,KAAK,KAAK,CAAC,GAAG,KAAK,EAAE,SAAS,cAAc,OAAO;AAAA,EACnE;AACF;",
  "names": ["crypto"]
}
